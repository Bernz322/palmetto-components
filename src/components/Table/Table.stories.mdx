import { useState } from 'react';
import { action } from '@storybook/addon-actions';
import { withA11y } from '@storybook/addon-a11y';
import { Meta, Story, Preview, Props } from '@storybook/addon-docs/blocks';
import Table from './Table';


<Meta
  title="Components/Table"
  component={Table}
  decorators={[withA11y]}
/>

# Table

I'm a table!

## Props

<Props of={Table} />

## Default

<Preview>
  <Story name="Default">
    {() => {
      const columnConfig = [
        {heading: 'First Column', id: 'first'},
        {heading: 'Second Column', id: 'second'},
        {heading: 'Third Column', id: 'third'},
      ];
      const tableData = [
        ['1', 'foo', 'vanilla'],
        ['2', 'bar', 'chocolate'],
        ['3', 'bazz', 'strawberry'],
      ];
      return (
        <Table
          columnConfig={columnConfig}
          tableData={tableData}
        />
      );
    }}
  </Story>
</Preview>

## Sortable

<Preview>
  <Story name="Sortable">
    {() => {
      const defaultSortedColumn = null;
      const [sortedColumn, setSortedColumn] = useState(defaultSortedColumn);
      const columnConfig = [
        {heading: 'First Column', id: 'first', isSortable: true},
        {heading: 'Second Column', id: 'second'},
        {heading: 'Third Column', id: 'third', isSortable: true},
      ];
      const firstAsc = [
        ['1', 'foo', 'vanilla'],
        ['2', 'bar', 'chocolate'],
        ['3', 'bazz', 'strawberry'],
      ];
      const firstDesc = [
        ['3', 'bazz', 'strawberry'],
        ['2', 'bar', 'chocolate'],
        ['1', 'foo', 'vanilla'],
      ];
      const thirdAsc = [
        ['2', 'bar', 'chocolate'],
        ['3', 'bazz', 'strawberry'],
        ['1', 'foo', 'vanilla'],
      ];
      const thirdDesc = [
        ['1', 'foo', 'vanilla'],
        ['3', 'bazz', 'strawberry'],
        ['2', 'bar', 'chocolate'],
      ];
      const handleTableHeaderClick = headerId => {
        let direction;
        if (!sortedColumn || headerId !== sortedColumn.id) {
          direction = 'desc';
        } else {
          direction = (sortedColumn.sortOrder === 'desc') ? 'asc' : 'desc';
        }
        const newSortedColumn = {
          id: headerId,
          sortOrder: direction,
        };
        setSortedColumn(newSortedColumn);
      };
      const generateTableData = () => {
        if (sortedColumn?.id === 'first') {
          return sortedColumn.sortOrder === 'asc' ? firstAsc : firstDesc;
        } else if (sortedColumn?.id === 'third') {
          return sortedColumn.sortOrder === 'asc' ? thirdAsc : thirdDesc;
        } else {
          return firstAsc
        }
      }
      return (
        <Table
          columnConfig={columnConfig}
          tableData={generateTableData()}
          onSort={handleTableHeaderClick}
          sortedColumn={sortedColumn}
          isResponsive
        />
      );
    }}
  </Story>
</Preview>

## Sortable with Default Sorted Column

<Preview>
  <Story name="Sortable with Default Sorted Column">
    {() => {
      const defaultSortedColumn = {
        id: 'third',
        sortOrder: 'desc',
      };
      const [sortedColumn, setSortedColumn] = useState(defaultSortedColumn);
      const columnConfig = [
        {heading: 'First Column', id: 'first', isSortable: true},
        {heading: 'Second Column', id: 'second'},
        {heading: 'Third Column', id: 'third', isSortable: true},
      ];
      const firstAsc = [
        ['1', 'foo', 'vanilla'],
        ['2', 'bar', 'chocolate'],
        ['3', 'bazz', 'strawberry'],
      ];
      const firstDesc = [
        ['3', 'bazz', 'strawberry'],
        ['2', 'bar', 'chocolate'],
        ['1', 'foo', 'vanilla'],
      ];
      const thirdAsc = [
        ['2', 'bar', 'chocolate'],
        ['3', 'bazz', 'strawberry'],
        ['1', 'foo', 'vanilla'],
      ];
      const thirdDesc = [
        ['1', 'foo', 'vanilla'],
        ['3', 'bazz', 'strawberry'],
        ['2', 'bar', 'chocolate'],
      ];
      const handleTableHeaderClick = headerId => {
        let direction;
        if (!sortedColumn || headerId !== sortedColumn.id) {
          direction = 'desc';
        } else {
          direction = (sortedColumn.sortOrder === 'desc') ? 'asc' : 'desc';
        }
        const newSortedColumn = {
          id: headerId,
          sortOrder: direction,
        };
        setSortedColumn(newSortedColumn);
      };
      const generateTableData = () => {
        if (sortedColumn?.id === 'first') {
          return sortedColumn.sortOrder === 'asc' ? firstAsc : firstDesc;
        } else if (sortedColumn?.id === 'third') {
          return sortedColumn.sortOrder === 'asc' ? thirdAsc : thirdDesc;
        } else {
          return firstAsc
        }
      }
      return (
        <Table
          columnConfig={columnConfig}
          tableData={generateTableData()}
          onSort={handleTableHeaderClick}
          sortedColumn={sortedColumn}
          isResponsive
        />
      );
    }}
  </Story>
</Preview>

## Sortable and Loading

Setting the `isLoading` prop to true will disable clicking on the column headers. This prevents a race condition where an attempt to sort is made before data from the previous load is available.

<Preview>
  <Story name="Sortable and Loading">
    {() => {
      const defaultSortedColumn = null;
      const [sortedColumn, setSortedColumn] = useState(defaultSortedColumn);
      const columnConfig = [
        {heading: 'First Column', id: 'first', isSortable: true},
        {heading: 'Second Column', id: 'second'},
        {heading: 'Third Column', id: 'third', isSortable: true},
      ];
      const firstAsc = [
        ['1', 'foo', 'vanilla'],
        ['2', 'bar', 'chocolate'],
        ['3', 'bazz', 'strawberry'],
      ];
      const firstDesc = [
        ['3', 'bazz', 'strawberry'],
        ['2', 'bar', 'chocolate'],
        ['1', 'foo', 'vanilla'],
      ];
      const thirdAsc = [
        ['2', 'bar', 'chocolate'],
        ['3', 'bazz', 'strawberry'],
        ['1', 'foo', 'vanilla'],
      ];
      const thirdDesc = [
        ['1', 'foo', 'vanilla'],
        ['3', 'bazz', 'strawberry'],
        ['2', 'bar', 'chocolate'],
      ];
      const handleTableHeaderClick = headerId => {
        let direction;
        if (!sortedColumn || headerId !== sortedColumn.id) {
          direction = 'desc';
        } else {
          direction = (sortedColumn.sortOrder === 'desc') ? 'asc' : 'desc';
        }
        const newSortedColumn = {
          id: headerId,
          sortOrder: direction,
        };
        setSortedColumn(newSortedColumn);
      };
      const generateTableData = () => {
        if (sortedColumn?.id === 'first') {
          return sortedColumn.sortOrder === 'asc' ? firstAsc : firstDesc;
        } else if (sortedColumn?.id === 'third') {
          return sortedColumn.sortOrder === 'asc' ? thirdAsc : thirdDesc;
        } else {
          return firstAsc
        }
      }
      return (
        <Table
          columnConfig={columnConfig}
          tableData={generateTableData()}
          onSort={handleTableHeaderClick}
          sortedColumn={sortedColumn}
          isResponsive
          isLoading
        />
      );
    }}
  </Story>
</Preview>

## Responsive

<Preview>
  <Story name="Responsive">
    {() => {
      const columnConfig = [
        {heading: 'First Column', id: 'first'},
        {heading: 'Second Column', id: 'second'},
        {heading: 'Third Column', id: 'third'},
        {heading: 'Fourth Column', id: 'fourth'},
        {heading: 'Fifth Column', id: 'fifth'},
        {heading: 'Sixth Column', id: 'sixth'},
        {heading: 'Seventh Column', id: 'seventh'},
        {heading: 'Eighth Column', id: 'eighth'},
        {heading: 'Nineth Column', id: 'nineth'},
        {heading: 'Tenth Column', id: 'tenth'},
        {heading: 'Eleventh Column', id: 'eleventh'},
        {heading: 'Twelfth Column', id: 'twelfth'},
        {heading: 'Thirteenth Column', id: 'thirteenth'},
        {heading: 'Fourteenth Column', id: 'fourteenth'},
      ];
      const tableData = [
        ['1', 'foo', 'vanilla', 'Fran', 'BA', 'CA', 'DA', 'EA', 'FA', 'GA', 'HA', 'IA', 'JA', 'KA'],
        ['2', 'bar', 'chocolate', 'Bob', 'BB', 'CB', 'DB', 'EB', 'FB', 'GB', 'HB', 'IB', 'JB', 'KB'],
        ['3', 'bazz', 'strawberry', 'Cole', 'BC', 'CC', 'DC', 'EC', 'FC', 'GC', 'HC', 'IC', 'JC', 'KC'],
      ];
      return (
        <Table
          columnConfig={columnConfig}
          tableData={tableData}
          isResponsive
        />
      );
    }}
  </Story>
</Preview>

## Fixed-Width Columns

<Preview>
  <Story name="Fixed-Width Columns">
    {() => {
      const columnConfig = [
        {heading: 'First Column', id: 'first', width: '315'},
        {heading: 'Second Column', id: 'second', width: '215'},
        {heading: 'Third Column', id: 'third', width: '100'},
      ];
      const tableData = [
        ['1', 'foo', 'vanilla'],
        ['2', 'bar', 'chocolate'],
        ['3', 'bazz', 'strawberry strawberry strawberry strawberry'],
      ];
      return (
        <Table
          columnConfig={columnConfig}
          tableData={tableData}
          useFixedWidthColumns
        />
      );
    }}
  </Story>
</Preview>

## Truncate Overflow

<Preview>
  <Story name="Truncate Overflow">
    {() => {
      const columnConfig = [
        {heading: 'First Column', id: 'first', width: '70'},
        {heading: 'Second Column', id: 'second', width: '215'},
        {heading: 'Third Column', id: 'third', width: '100'},
      ];
      const tableData = [
        ['1', 'foofoofoofoofoofoofoofoofoofoofoofoo', 'vanilla'],
        ['2', 'bar', 'chocolatechocolatechocolatechocolate'],
        ['3', 'baz', 'strawberry strawberry strawberry strawberry'],
      ];
      return (
        <Table
          columnConfig={columnConfig}
          tableData={tableData}
          useFixedWidthColumns
          truncateOverflow
        />
      );
    }}
  </Story>
</Preview>

## Striped

<Preview>
  <Story name="Striped">
    {() => {
      const columnConfig = [
        {heading: 'First Column', id: 'first'},
        {heading: 'Second Column', id: 'second'},
        {heading: 'Third Column', id: 'third'},
      ];
      const tableData = [
        ['1', 'foo', 'vanilla'],
        ['2', 'bar', 'chocolate'],
        ['3', 'bazz', 'strawberry'],
      ];
      return (
        <Table
          columnConfig={columnConfig}
          tableData={tableData}
          isStriped
        />
      );
    }}
  </Story>
</Preview>

## Empty Cell Placeholder

<Preview>
  <Story name="Empty Cell Placeholder">
    {() => {
      const columnConfig = [
        {heading: 'First Column', id: 'first'},
        {heading: 'Second Column', id: 'second'},
        {heading: 'Third Column', id: 'third'},
      ];
      const tableData = [
        [undefined, 'foo', 'vanilla'],
        ['2', null, 'chocolate'],
        ['3', 'bazz', ''],
      ];
      return (
        <Table
          columnConfig={columnConfig}
          tableData={tableData}
          emptyCellPlaceholder="--"
        />
      );
    }}
  </Story>
</Preview>

## Borderless

<Preview>
  <Story name="Borderless">
    {() => {
      const columnConfig = [
        {heading: 'First Column', id: 'first'},
        {heading: 'Second Column', id: 'second'},
        {heading: 'Third Column', id: 'third'},
      ];
      const tableData = [
        ['1', 'foo', 'vanilla'],
        ['2', 'bar', 'chocolate'],
        ['3', 'bazz', 'strawberry'],
      ];
      return (
        <Table
          columnConfig={columnConfig}
          tableData={tableData}
          isBorderless
        />
      );
    }}
  </Story>
</Preview>

## Less Padding

<Preview>
  <Story name="Less Padding">
    {() => {
      const columnConfig = [
        {heading: 'First Column', id: 'first'},
        {heading: 'Second Column', id: 'second'},
        {heading: 'Third Column', id: 'third'},
      ];
      const tableData = [
        ['1', 'foo', 'vanilla'],
        ['2', 'bar', 'chocolate'],
        ['3', 'bazz', 'strawberry'],
      ];
      return (
        <Table
          columnConfig={columnConfig}
          tableData={tableData}
          useLessPadding
        />
      );
    }}
  </Story>
</Preview>

## Hover

<Preview>
  <Story name="Hover">
    {() => {
      const columnConfig = [
        {heading: 'First Column', id: 'first'},
        {heading: 'Second Column', id: 'second'},
        {heading: 'Third Column', id: 'third'},
      ];
      const tableData = [
        ['1', 'foo', 'vanilla'],
        ['2', 'bar', 'chocolate'],
        ['3', 'bazz', 'strawberry'],
      ];
      return (
        <Table
          columnConfig={columnConfig}
          tableData={tableData}
          isStriped
          hoverableRows
        />
      );
    }}
  </Story>
</Preview>

## Loading

<Preview>
  <Story name="Loading">
    {() => {
      const columnConfig = [
        {heading: 'First Column', id: 'first'},
        {heading: 'Second Column', id: 'second'},
        {heading: 'Third Column', id: 'third'},
      ];
      const tableData = [
        ['1', 'foo', 'vanilla'],
        ['2', 'bar', 'chocolate'],
        ['3', 'bazz', 'strawberry'],
      ];
      return (
        <>
          <Table
            columnConfig={columnConfig}
            tableData={tableData}
            isLoading
          />
          <span>Add custom "loading" message here.</span>
        </>
      );
    }}
  </Story>
</Preview>

## Loading Failed

<Preview>
  <Story name="Loading Failed">
    {() => {
      const columnConfig = [
        {heading: 'First Column', id: 'first'},
        {heading: 'Second Column', id: 'second'},
        {heading: 'Third Column', id: 'third'},
      ];
      const tableData = [
        ['1', 'foo', 'vanilla'],
        ['2', 'bar', 'chocolate'],
        ['3', 'bazz', 'strawberry'],
      ];
      return (
        <>
          <Table
            columnConfig={columnConfig}
            tableData={tableData}
            loadingFailed
          />
          <span>Add custom "load failed" message here.</span>
        </>
      );
    }}
  </Story>
</Preview>
